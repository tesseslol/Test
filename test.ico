const int buttonPin = 2;
const int ledPin = 12;
const int buzzer = 7;
const int pirSensor = 8; // choose the input pin (for PIR sensor)

bool pirState = LOW;
int val = 0;
unsigned long currentMillis = 0;
bool buttonState = LOW;
bool claymoreStatus = false;
unsigned long previousMillis = 0;
const long interval = 10000;

void setup() {
  pinMode(ledPin, OUTPUT);
  pinMode(buttonPin, INPUT);
  pinMode(buzzer, OUTPUT);
  pinMode(pirSensor, INPUT);
}

void loop() {
  currentMillis = millis();
  buttonState = digitalRead(buttonPin);
  val = digitalRead(pirSensor);

  if (buttonState == HIGH) {
    changeStatus();
  }
  
  if (claymoreStatus) {
    if (currentMillis - previousMillis >= interval) {
      previousMillis = currentMillis;
      tone(buzzer, 440, 1000);
    }
    if (val == HIGH) {
      digitalWrite(ledPin, HIGH);
      delay(200);
      digitalWrite(ledPin, LOW);
      if (pirState == LOW) {
        Serial.println("Motion detected!");
        pirState = HIGH;
      }
    } else {
      digitalWrite(ledPin, LOW);
      if (pirState == HIGH) {
        Serial.println("Motion ended!");
        tone(buzzer, 440, 1000);
        delay(1500);
        tone(buzzer, 440, 1000);
        delay(1500);
        tone(buzzer, 440, 1000);
        delay(1500);
        tone(buzzer, 440, 1000);
        delay(1500);
        tone(buzzer, 440, 1000);
        delay(1500);
        changeStatus();
      }
      pirState = LOW;
    }
  }
  
  delay(200);
}

void changeStatus() {
  if (claymoreStatus) {
    claymoreStatus = false;
    digitalWrite(ledPin, HIGH);
    noTone(buzzer);
    delay(100);
  } else {
    claymoreStatus = true;
    digitalWrite(ledPin, LOW);
    emitSound(333);
    emitSound(333);
    emitSound(333);
  }
}


void emitSound(unsigned int timeS) {
  tone(buzzer, 440);
  delay(timeS);
  noTone(buzzer);
  delay(timeS);
}
